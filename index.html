
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solo Guy Cotten 2025 - Live Tracking</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #windy {
      width: 100%;
      height: 100vh;
    }
  </style>
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>
</head>
<body>
  <div id="windy"></div>

  <script>
    const options = {
      key: 'emTiHvhBnO0yJIx2mGKca5wADXNbEM1A', // Ta vraie clé API Windy ici
      verbose: true,
      lat: 47.87,
      lon: -3.92,
      zoom: 8,
    };

    windyInit(options, windyAPI => {
      const { map } = windyAPI;

      async function loadPositions() {
        try {
          const res = await fetch('https://yb.tl/XML/solo2025_3');
          const text = await res.text();
          const parser = new DOMParser();
          const xml = parser.parseFromString(text, "application/xml");

          if (window.markers) {
            window.markers.forEach(m => map.removeLayer(m));
          }
          window.markers = [];

          const devices = xml.querySelectorAll("Device");

          devices.forEach(device => {
            const name = device.getAttribute("name") || "Unnamed";
            const pos = device.querySelector("Position");
            if (!pos) return;

            const lat = parseFloat(pos.querySelector("Latitude").textContent);
            const lon = parseFloat(pos.querySelector("Longitude").textContent);
            const sog = pos.querySelector("SOG")?.textContent || "N/A";
            const cog = pos.querySelector("COG")?.textContent || "N/A";
            const time = pos.querySelector("GpsAt")?.textContent || "N/A";

            const popupContent = `
              <b>${name}</b><br>
              <small>${time}</small><br>
              Lat: ${lat.toFixed(4)}<br>
              Lon: ${lon.toFixed(4)}<br>
              Vitesse: ${sog} kt<br>
              Cap: ${cog}°
            `;

            const marker = L.marker([lat, lon])
              .addTo(map)
              .bindPopup(popupContent);
            window.markers.push(marker);
          });
        } catch (err) {
          console.error("Erreur de chargement du flux XML :", err);
        }
      }

      loadPositions();
      setInterval(loadPositions, 15 * 60 * 1000);
    });
  </script>
</body>
</html>
